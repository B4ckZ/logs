
================================================================================
DÉMARRAGE: nginx_install
Description: Installation Nginx et Dashboard (hybride)
Date: Sat 31 May 22:47:06 CEST 2025
Utilisateur: root
Répertoire: /media/prod/MAXLINK
================================================================================

[2025-05-31 22:47:06] [INFO] [nginx_install] Script nginx_install initialisé
[2025-05-31 22:47:06] [INFO] [nginx_install] ========== DÉBUT DE L'INSTALLATION NGINX ET DASHBOARD (HYBRIDE) ==========
[2025-05-31 22:47:06] [INFO] [nginx_install] Progression: 5% - Vérifications initiales...
[2025-05-31 22:47:06] [INFO] [nginx_install] Privilèges root confirmés
[2025-05-31 22:47:07] [INFO] [nginx_install] Progression: 10% - Vérifications terminées
[2025-05-31 22:47:09] [INFO] [nginx_install] Progression: 20% - Installation de Nginx...
[2025-05-31 22:47:09] [INFO] [nginx_install] Installation hybride de Nginx
[2025-05-31 22:47:09] [INFO] [nginx_install] Tentative d'installation depuis le cache
[2025-05-31 22:47:11] [SUCCESS] [nginx_install] Nginx installé depuis le cache
[2025-05-31 22:47:11] [SUCCESS] [nginx_install] Nginx installé avec succès
[2025-05-31 22:47:11] [CMD] [nginx_install] Exécution: Arrêt Nginx
[2025-05-31 22:47:11] [CMD] [nginx_install] Commande: systemctl stop nginx >/dev/null 2>&1
[2025-05-31 22:47:11] [CMD] [nginx_install] Code de sortie: 0
[2025-05-31 22:47:12] [INFO] [nginx_install] Progression: 35% - Nginx installé
[2025-05-31 22:47:14] [INFO] [nginx_install] Progression: 40% - Installation du dashboard...
[2025-05-31 22:47:14] [INFO] [nginx_install] Vérification du cache dashboard
[2025-05-31 22:47:14] [INFO] [nginx_install] Dashboard trouvé dans le cache
[2025-05-31 22:47:14] [INFO] [nginx_install] Répertoire temporaire: /tmp/maxlink-dashboard-1748724434
[2025-05-31 22:47:14] [CMD] [nginx_install] Exécution: Extraction archive
[2025-05-31 22:47:14] [CMD] [nginx_install] Commande: tar -xzf '/var/cache/maxlink/dashboard/dashboard.tar.gz' -C '/tmp/maxlink-dashboard-1748724434'
[2025-05-31 22:47:14] [CMD] [nginx_install] Code de sortie: 0
[2025-05-31 22:47:14] [SUCCESS] [nginx_install] Archive extraite avec succès
[2025-05-31 22:47:15] [INFO] [nginx_install] Dossier racine de l'archive: /tmp/maxlink-dashboard-1748724434/MaxLink-main
[2025-05-31 22:47:15] [INFO] [nginx_install] Recherche du dashboard dans: /tmp/maxlink-dashboard-1748724434/MaxLink-main/DashBoardV1
[2025-05-31 22:47:15] [INFO] [nginx_install] Dossier dashboard trouvé: /tmp/maxlink-dashboard-1748724434/MaxLink-main/DashBoardV1
[2025-05-31 22:47:15] [CMD] [nginx_install] Exécution: Copie dashboard
[2025-05-31 22:47:15] [CMD] [nginx_install] Commande: cp -r '/tmp/maxlink-dashboard-1748724434/MaxLink-main/DashBoardV1' '/var/www/maxlink-dashboard'
[2025-05-31 22:47:15] [CMD] [nginx_install] Code de sortie: 0
[2025-05-31 22:47:15] [SUCCESS] [nginx_install] Dashboard installé avec succès
[2025-05-31 22:47:15] [INFO] [nginx_install] Nettoyage du répertoire temporaire
[2025-05-31 22:47:15] [CMD] [nginx_install] Exécution: Application propriétaire et groupe
[2025-05-31 22:47:15] [CMD] [nginx_install] Commande: chown -R www-data:www-data '/var/www/maxlink-dashboard'
[2025-05-31 22:47:16] [CMD] [nginx_install] Code de sortie: 0
[2025-05-31 22:47:16] [CMD] [nginx_install] Exécution: Permissions 775 (lecture/écriture groupe)
[2025-05-31 22:47:16] [CMD] [nginx_install] Commande: chmod -R 775 '/var/www/maxlink-dashboard'
[2025-05-31 22:47:16] [CMD] [nginx_install] Code de sortie: 0
[2025-05-31 22:47:16] [CMD] [nginx_install] Exécution: Sticky bit sur dossiers
[2025-05-31 22:47:16] [CMD] [nginx_install] Commande: find '/var/www/maxlink-dashboard' -type d -exec chmod g+s {} \;
[2025-05-31 22:47:16] [CMD] [nginx_install] Code de sortie: 0
[2025-05-31 22:47:16] [INFO] [nginx_install] Dashboard accessible en écriture pour le groupe www-data
[2025-05-31 22:47:16] [INFO] [nginx_install] Progression: 60% - Dashboard installé
[2025-05-31 22:47:19] [INFO] [nginx_install] Progression: 70% - Configuration de Nginx...
[2025-05-31 22:47:19] [INFO] [nginx_install] Création de la configuration Nginx
[2025-05-31 22:47:19] [SUCCESS] [nginx_install] Configuration Nginx créée
[2025-05-31 22:47:19] [CMD] [nginx_install] Exécution: Suppression site par défaut
[2025-05-31 22:47:19] [CMD] [nginx_install] Commande: rm -f /etc/nginx/sites-enabled/default 2>/dev/null || true
[2025-05-31 22:47:19] [CMD] [nginx_install] Code de sortie: 0
[2025-05-31 22:47:19] [CMD] [nginx_install] Exécution: Suppression ancien lien
[2025-05-31 22:47:19] [CMD] [nginx_install] Commande: rm -f /etc/nginx/sites-enabled/maxlink-dashboard 2>/dev/null || true
[2025-05-31 22:47:19] [CMD] [nginx_install] Code de sortie: 0
[2025-05-31 22:47:19] [CMD] [nginx_install] Exécution: Création lien symbolique
[2025-05-31 22:47:20] [CMD] [nginx_install] Commande: ln -s /etc/nginx/sites-available/maxlink-dashboard /etc/nginx/sites-enabled/
[2025-05-31 22:47:20] [CMD] [nginx_install] Code de sortie: 0
[2025-05-31 22:47:20] [INFO] [nginx_install] Site Nginx activé
[2025-05-31 22:47:20] [CMD] [nginx_install] Exécution: Test configuration Nginx
[2025-05-31 22:47:20] [CMD] [nginx_install] Commande: nginx -t >/dev/null 2>&1
[2025-05-31 22:47:20] [CMD] [nginx_install] Code de sortie: 0
[2025-05-31 22:47:20] [SUCCESS] [nginx_install] Configuration Nginx valide
[2025-05-31 22:47:20] [INFO] [nginx_install] Delay de démarrage Nginx configuré: 20s
[2025-05-31 22:47:21] [CMD] [nginx_install] Exécution: Activation au démarrage
[2025-05-31 22:47:21] [CMD] [nginx_install] Commande: systemctl enable nginx >/dev/null 2>&1
[2025-05-31 22:47:21] [CMD] [nginx_install] Code de sortie: 0
[2025-05-31 22:47:22] [CMD] [nginx_install] Exécution: Démarrage Nginx
[2025-05-31 22:47:22] [CMD] [nginx_install] Commande: systemctl start nginx >/dev/null 2>&1
[2025-05-31 22:47:42] [CMD] [nginx_install] Code de sortie: 0
[2025-05-31 22:47:42] [SUCCESS] [nginx_install] Nginx démarré avec succès
[2025-05-31 22:47:42] [INFO] [nginx_install] Progression: 85% - Nginx configuré
[2025-05-31 22:47:44] [INFO] [nginx_install] Progression: 90% - Configuration DNS...
[2025-05-31 22:47:44] [INFO] [nginx_install] Vérification de la configuration AP existante
[2025-05-31 22:47:44] [INFO] [nginx_install] Mode AP détecté, mise à jour DNS nécessaire
[2025-05-31 22:47:44] [INFO] [nginx_install] Configuration DNS déjà présente
[2025-05-31 22:47:45] [INFO] [nginx_install] Progression: 100% - Installation terminée !
[2025-05-31 22:47:45] [INFO] [nginx_install] Installation terminée avec succès
[2025-05-31 22:47:45] [INFO] [nginx_install] Dashboard accessible à: http://192.168.4.1 et http://maxlink-dashboard.local
[2025-05-31 22:47:45] [INFO] [nginx_install] Redémarrage du système prévu dans 15 secondes
[2025-05-31 22:48:00] [INFO] [nginx_install] Redémarrage du système
[2025-05-31 22:48:00] [INFO] [nginx_install] Script nginx_install terminé avec le code 0
